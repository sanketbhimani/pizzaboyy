<html>

<head>
    <script src="./js/jquery-3.2.0.min.js"></script>
    <script src="./js/materialize.min.js"></script>
    <!--<script src="./js/app.js"></script>-->
    <link rel="stylesheet" href="./css/materialize.min.css" />
    <link rel="stylesheet prefetch" href="./font/font" />
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#EF5350">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PizzaBoyy">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PizzaBoyy</title>
</head>

<body style="background-color: #ccc;">
    <style>
        .select-dropdown {
            overflow-y: auto !important;
        }
    </style>
    <nav style="position: fixed; z-index: 1000; top: 0;">
        <div class="nav-wrapper">
            <span class="brand-logo">PizzaBoyy</span>
        </div>
    </nav>
    <div id='add_btn' style="position: fixed; z-index:1000; bottom: 15; right: 15;">
        <a class="btn-floating btn-large waves-effect waves-light red" onclick="$('#add_btn').hide(); $('.select_cheeses').show(); $('.orders').hide();">
            <i class="material-icons">add</i>
        </a>
    </div>
    <div class="container white" style="margin: 6px; padding: 9px; margin-top: 18%; border-radius: 5px; width: 97%; min-height:98%; border: 2px solid #ffffff;">
        <div class="orders">
            <h3 class='center'>Your Past Orders</h3>
            <span class="no_orders"></span>

            <div class="collection order_data">

            </div>
        </div>
        <div class="place_order">
            <div class="select_cheeses">
                <div class="scheeses">
                    <h3 class="center">Select Cheeses</h3>
                </div>
                <div class='row'>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_cheeses').hide(); $('.orders').show(); $('#add_btn').show();">close</a>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_cheeses').hide(); $('.select_toppings').show();">next</a>
                </div>
            </div>
            <div class="select_toppings">
                <div class="stoppings">
                    <h3 class="center">Select Toppings</h3>
                </div>
                <div class='row'>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_cheeses').show(); $('.select_toppings').hide();">prev</a>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_sauces').show(); $('.select_toppings').hide();">next</a>
                </div>
            </div>
            <div class="select_sauces">
                <div class="ssauces">
                    <h3 class="center">Select Sauces</h3>
                </div>
                <div class='row'>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_toppings').show(); $('.select_sauces').hide();">prev</a>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_crust').show(); $('.select_sauces').hide();">next</a>
                </div>
            </div>
            <div class="select_crust">
                <div class="scrustes">
                    <h3 class="center">Select Crust</h3>
                </div>
                <div class='row'>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_crust').hide(); $('.select_sauces').show();">prev</a>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_size').show(); $('.select_crust').hide();">next</a>
                </div>
            </div>
            <div class="select_size">
                <div class="ssizes">
                    <h3 class="center">Select Size</h3>
                </div>
                <div class='row'>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_size').hide(); $('.select_crust').show();">prev</a>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.basic_details').show(); $('.select_size').hide();">next</a>
                </div>
            </div>
            <div class="basic_details">
                <h3>Basic Details</h3>
                <div class="input-field col s6">
                    <input id="full_name" type="text" class="validate">
                    <label for="full_name">Full Name</label>
                </div>
                <div class="input-field col s6">
                    <input id="address" type="text" class="validate">
                    <label for="address">Address</label>
                </div>
                <div class="input-field col s6">
                    <input id="city" type="text" class="validate">
                    <label for="city">City</label>
                </div>
                <div class="input-field col s6">
                    <input id="pincode" type="number" class="validate">
                    <label for="pincode">Pincode</label>
                </div>
                <div class="input-field col s6">
                    <input id="phonenumber" type="number" class="validate">
                    <label for="phonenumber">Phone Number</label>
                </div>
                <div class="input-field col s6">
                    <input id="comment" type="text" class="validate">
                    <label for="comment">Extra Comment</label>
                </div>
                <div class="row">
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.select_size').show(); $('.basic_details').hide();">prev</a>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="fill();">next</a>
                </div>
            </div>
            <div class="confirm_details">
                <h4>Confirm Details</h4>
                <div class="row">
                    <div class="col m3 s3">Name:- </div>
                    <div class="col m8 s8 name"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Address:- </div>
                    <div class="col m8 s8 address"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">City:- </div>
                    <div class="col m8 s8 city" class=''></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Pincode:- </div>
                    <div class="col m8 s8 pincode"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Phone Number:- </div>
                    <div class="col m8 s8 phonenumber"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Extra Comment:- </div>
                    <div class="col m8 s8 comment"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Chesses:- </div>
                    <div class="col m8 s8 cheeses"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Toppings:- </div>
                    <div class="col m8 s8 toppings"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Sauces:- </div>
                    <div class="col m8 s8 sauces"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Crust:- </div>
                    <div class="col m8 s8 crust"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Size:- </div>
                    <div class="col m8 s8 size"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Total:- </div>
                    <div class="col m8 s8 total"></div>
                </div>
                <div class="row">
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.confirm_details').hide(); $('.basic_details').show();">Edit</a>
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="place();">place order</a>
                </div>
            </div>
            <div class="order_details">
                <div class="row">
                    <div class="col m3 s3">Name:- </div>
                    <div class="col m8 s8 oname"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Address:- </div>
                    <div class="col m8 s8 oaddress"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">City:- </div>
                    <div class="col m8 s8 ocity" class=''></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Pincode:- </div>
                    <div class="col m8 s8 opincode"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Phone Number:- </div>
                    <div class="col m8 s8 ophonenumber"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Extra Comment:- </div>
                    <div class="col m8 s8 ocomment"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Chesses:- </div>
                    <div class="col m8 s8 ocheeses"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Toppings:- </div>
                    <div class="col m8 s8 otoppings"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Sauces:- </div>
                    <div class="col m8 s8 osauces"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Crust:- </div>
                    <div class="col m8 s8 ocrust"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Size:- </div>
                    <div class="col m8 s8 osize"></div>
                </div>
                <div class="row">
                    <div class="col m3 s3">Total:- </div>
                    <div class="col m8 s8 ototal"></div>
                </div>
                <div class="row">
                    <a class="col m6 s6 waves-effect waves-light btn" onclick="$('.orders').show(); $('#add_btn').show(); $('.order_details').hide();">back</a>
                </div>
            </div>
        </div>
        <div class="preloader-wrapper big active">
            <div class="spinner-layer spinner-blue-only">
                <div class="circle-clipper left">
                    <div class="circle"></div>
                </div>
                <div class="gap-patch">
                    <div class="circle"></div>
                </div>
                <div class="circle-clipper right">
                    <div class="circle"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="loader" style='position: absolute; right:50; top:50; z-index: 2000;' class="preloader-wrapper big active">
        <div class="spinner-layer spinner-blue-only">
            <div class="circle-clipper left">
                <div class="circle"></div>
            </div>
            <div class="gap-patch">
                <div class="circle"></div>
            </div>
            <div class="circle-clipper right">
                <div class="circle"></div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            fill_order();
            $('.container').hide();
            $('.loader').show();
        });

        function fill_order() {
            if ((readCookie('cnt') === null) || (readCookie('cnt') === '0')) {
                $(".no_orders").html("<blockquote>No past orders,<br>click '+' to place order!</blockquote>");
            } else {
                $(".no_orders").html("");
            }
            $('.order_data').html('');
            var cnt = readCookie('cnt');
            for (var i = 1; i <= cnt; i++) {
                var data = '<a href="#" onclick="show_data(\'' + readCookie('order' + i) + '\');" class="collection-item">' + readCookie('order' + i) + '</a>';
                $('.order_data').html($('.order_data').html() + data);
            }
        }

        function show_data(id) {
            $.getJSON('http://138.197.124.3:8080/get_order_details/' + id, function(jd) {
                jd = jd[0];
                $(".oname").html(jd.name);
                $(".ophonenumber").html(jd.phone_number);
                $(".ocity").html(jd.city);
                $(".oaddress").html(jd.address);
                $(".opincode").html(jd.pincode);
                $(".ocomment").html(jd.comment);
                $(".ocheeses").html(jd.cheeses.join(', '));
                $(".otoppings").html(jd.toppings.join(', '));
                $(".osauces").html(jd.sauces.join(', '));
                $(".ocrust").html(jd.crust);
                $(".osize").html(jd.size);
                $(".ototal").html(jd.total_price);
            });
            $(".order_details").show();
            $('.orders').hide();
            $('#add_btn').hide();
        }

        $(".select_cheeses").hide();
        $(".select_toppings").hide();
        $(".select_sauces").hide();
        $(".select_crust").hide();
        $(".select_size").hide();
        $(".basic_details").hide();
        $(".confirm_details").hide();
        $(".order_details").hide();

        $.getJSON('http://138.197.124.3:8080/get_cheeses', function(jd) {
            jd.cheeses.forEach(function(cheese, index) {
                $(".scheeses").html($(".scheeses").html() + "<div class='col m6 s6'><input type='checkbox' value='" + cheese.type + "' cost='" + cheese.cost + "' id='cheese" + index + "'> <label style='color:black;' for='cheese" + index + "'>" + cheese.type + "(" + cheese.cost + ")" + "</label></div>");
            });
        });

        $.getJSON('http://138.197.124.3:8080/get_toppings', function(jd) {
            jd.toppings.forEach(function(topping, index) {
                $(".stoppings").html($(".stoppings").html() + "<div class='col m6 s6'><input type='checkbox' value='" + topping.type + "' cost='" + topping.cost + "' id='topping" + index + "'> <label style='color:black;' for='topping" + index + "'>" + topping.type + "(" + topping.cost + ")" + "</label></div>");
            });
            $.getJSON('http://138.197.124.3:8080/get_sauces', function(jd) {
                jd.sauces.forEach(function(sauces, index) {
                    $(".ssauces").html($(".ssauces").html() + "<div class='col m6 s6'><input type='checkbox' value='" + sauces.type + "' cost='" + sauces.cost + "' id='sauces" + index + "'> <label style='color:black;' for='sauces" + index + "'>" + sauces.type + "(" + sauces.cost + ")" + "</label></div>");
                });
                $.getJSON('http://138.197.124.3:8080/get_crustes', function(jd) {
                    jd.crustes.forEach(function(crustes, index) {
                        $(".scrustes").html($(".scrustes").html() + "<div class='col m6 s6'><input type='radio' name='crust' value='" + crustes.type + "' cost='" + crustes.cost + "' id='crustes" + index + "'> <label style='color:black;' for='crustes" + index + "'>" + crustes.type + "(" + crustes.cost + ")" + "</label></div>");
                        $("#crustes0").attr('checked', 'checked');
                    });
                    $.getJSON('http://138.197.124.3:8080/get_sizes', function(jd) {
                        jd.sizes.forEach(function(sizes, index) {
                            $(".ssizes").html($(".ssizes").html() + "<div class='col m6 s6'><input type='radio' name='size' value='" + sizes.size + "' cost='" + sizes.cost + "'  id='sizes" + index + "'> <label style='color:black;' for='sizes" + index + "'>" + sizes.size + "(" + sizes.cost + ")" + "</label></div>");
                            $("#sizes0").attr('checked', 'checked');
                        });
                        $('.container').show();
                        $('.loader').hide();
                    });
                });
            });
        });


        var cheeses = [];
        var toppings = [];
        var sauces = [];
        var cntc = 0;
        var cntt = 0;
        var cnts = 0;
        var costc = 0;
        var costt = 0;
        var costs = 0;
        var cost_c = 0;
        var cost_s = 0;
        var crust;
        var size;

        function fill() {
            var searchIDs = $('input:checked').map(function() {
                id = $(this).attr("id");
                if (id.indexOf("cheese") >= 0) {
                    cheeses[cntc++] = $(this).val();
                    costc += parseInt($(this).attr("cost"), 10);
                } else if (id.indexOf("topping") >= 0) {
                    toppings[cntt++] = $(this).val();
                    costt += parseInt($(this).attr("cost"), 10);
                } else if (id.indexOf("sauces") >= 0) {
                    sauces[cnts++] = $(this).val();
                    costs += parseInt($(this).attr("cost"), 10);
                }
            });

            if (cheeses.length == 0) {
                alert('Select atleast one cheese!');
                $('.select_cheeses').show();
                $('.basic_details').hide();
            } else if (toppings.length == 0) {
                alert('Select atleast one topping!');
                $('.select_toppings').show();
                $('.basic_details').hide();
            } else if (sauces.length == 0) {
                alert('Select atleast one sauce!');
                $('.basic_details').hide();
                $('.select_sauces').show();
            } else if ($("#full_name").val() == '' || $("#phonenumber").val() == '' || $("#city").val() == '' || $("#address").val() == '' || $("#pincode").val() == '') {
                alert('Fill all basic details!');
                $('.basic_details').show();
            } else {
                crust = $("input[name='crust']:checked").val();
                size = $("input[name='size']:checked").val();
                cost_c = parseInt($("input[name='crust']:checked").attr("cost"), 10);
                cost_s = parseInt($("input[name='crust']:checked").attr("cost"), 10);

                $(".name").html($("#full_name").val());
                $(".phonenumber").html($("#phonenumber").val());
                $(".city").html($("#city").val());
                $(".address").html($("#address").val());
                $(".pincode").html($("#pincode").val());
                $(".comment").html($("#comment").val());
                $(".cheeses").html(cheeses.toString() + "<br> Total Cost: " + costc);
                $(".toppings").html(toppings.toString() + "<br> Total Cost: " + costt);
                $(".sauces").html(sauces.toString() + "<br> Total Cost: " + costs);
                $(".crust").html(crust + "<br> Cost: " + cost_c);
                $(".size").html(size + "<br> Cost: " + cost_s);
                $(".total").html(cost_c + " + " + cost_s + " + " + costc + " + " + costs + " + " + costt + " + " + cost_c + " + " + cost_s + " + 60 = " + (costc + costs + costt + cost_c + cost_s + 60));
                $('.basic_details').hide();
                $('.confirm_details').show();
            }
        }

        function place() {
            $('.container').hide();
            $('.loader').show();
            var url = "http://138.197.124.3:8080/place_order?cheeses=" + cheeses.join("&cheeses=") + "&toppings=" + toppings.join("&toppings=") + "&sauces=" + sauces.join("&sauces=") + "&crust=" + crust + "&size=" + size + "&comment=" + $("#comment").val() + "&name=" + $("#full_name").val() + "&address=" + $("#address").val() + "&city=" + $("#city").val() + "&pincode=" + $("#pincode").val() + "&phone_number=" + $("#phonenumber").val() + "&total_price=" + (costc + costs + costt + cost_c + cost_s + 60) + "&date_time=" + new Date() + "&status=placed";
            $.getJSON(url, function(jd) {
                if (jd.error == 0) {
                    alert("Order Successfully placed and your order id is '" + jd.order_id + "' kindly note this id");
                    if (readCookie('cnt') != null) {
                        createCookie('cnt', parseInt(readCookie('cnt'), 10) + 1, 300);
                    } else {
                        createCookie('cnt', 1, 300);
                    }
                    createCookie('order' + readCookie('cnt'), jd.order_id, 300);
                    fill_order();
                    $('.confirm_details').hide();
                    $('.orders').show();
                    $('#add_btn').show();
                    $('.container').show();
                    $('.loader').hide();
                }
            });
        }

        function createCookie(name, value, days) {
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                var expires = "; expires=" + date.toGMTString();
            } else var expires = "";

            document.cookie = name + "=" + value + expires + "; path=/";
        }

        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
    </script>
</body>

</html>
